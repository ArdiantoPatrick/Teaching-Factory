@model IEnumerable<ProjekTeFa.Models.Booking>

@{
    Layout = "~/Views/Shared/LayoutServiceAdvisor.cshtml";
}
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Booking</h1>
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Transaksi</li>
        <li class="breadcrumb-item active" aria-current="page">Booking</li>
    </ol>
</div>

<div class="row mb-3">
    <div class="col-12">
        <div class="card" style="padding: 20px 20px 20px 20px;">
            <div class="table-responsive">
                <table id="table" class="table-hover text-nowrap">
                    <thead>
                        <tr>
                            <th hidden>id booking</th>
                            <th>No</th>
                            <th>Nama</th>
                            <th>Nomor Telepon</th>
                            <th>Rencana Tanggal</th>
                            <th>Rencana Waktu</th>
                            <th>Aktual Tanggal</th>
                            <th>Aktual Waktu</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            var no = 1;
                        }
                        @foreach (var obj in Model)
                        {
                            <tr>
                                <td hidden>@obj.id_booking</td>
                                <td>@no</td>
                                <td>@obj.Customer.nama_customer</td>
                                <td>@obj.Customer.notelp_customer</td>
                                <td>@obj.rencana_service_tanggal.ToString("d")</td>
                                <td>@obj.rencana_service_waktu</td>
                                @if (@obj.aktual_service_tanggal != null)
                                {
                                    <td><span class="badge badge-success" style="font-size:15px;">@obj.aktual_service_tanggal.Value.ToString("d")</span></td>
                                }
                                else
                                {
                                    <td><span class="badge badge-danger" style="font-size:15px;">Diisi oleh anda</span></td>
                                }
                                @if (@obj.aktual_service_waktu != null) 
                                {
                                    <td><span class="badge badge-success" style="font-size:15px;">@obj.aktual_service_waktu</span></td>
                                }
                                else
                                {
                                    <td><span class="badge badge-danger" style="font-size:15px;">Diisi oleh anda</span></td>
                                }
                                <td style="color:#fff">
                                    <a class="btn btn-success btn-sm" asp-action="Confirm" asp-route-id="@obj.id_booking">
                                        <i class="fa fa-check" data-toggle="tooltip" title="Konfirmasi Booking"></i>
                                    </a>
                                    <a class="btn btn-info btn-sm btnUpdate" id="bntUpdate" data-id="@obj.id_booking" data-tanggal="@obj.rencana_service_tanggal.ToString("d")" data-waktu="@obj.rencana_service_waktu" data-platno="@obj.nomor_polisi">
                                        <i class="fa fa-edit" data-toggle="tooltip" title="Update Booking"></i>
                                    </a>
                                    <a class="btn btn-danger btn-sm" asp-action="DeleteBooking" asp-route-id="@obj.id_booking">
                                        <i class="fa fa-trash" data-toggle="tooltip" title="Delete Booking"></i>
                                    </a>
                                    <a class="btn btn-primary btn-sm" asp-action="DetailBooking" asp-route-id="@obj.id_booking">
                                        <i class="fa fa-list" data-toggle="tooltip" title="Detail Booking"></i>
                                    </a>
                                </td>
                            </tr>
                            no++;
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@using (Html.BeginForm("Booking", "Booking", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
{
    <div class="modal fade" id="UpdateBooking" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">Service Kendaraan : <label id="platno"></label></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="text" id="id_booking" name="id" hidden />
                    <div class="col-12 form-group">
                        <label for="" class="form-label">Tanggal Rencana Service<span class="text-danger"> *</span></label>
                        <input type="date" class="form-control date-picker" id="tanggal" name="tanggal" />
                    </div>
                    <div class="col-12 form-group">
                        <label for="" class="form-label">Waktu Rencana Service<span class="text-danger"> *</span></label>
                        <input type="time" class="form-control time-picker" id="waktu" name="waktu" />
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
@*<hr />
<div class="d-sm-flex align-items-center justify-content-between mb-4 mt-4">
    <h1 class="h3 mb-0 text-gray-800">Booking Belum Diproses</h1>
</div>

<div class="row mb-3">
    <div class="col-12">
        <div class="card" style="padding: 20px 20px 20px 20px;">
            <div class="table-responsive">
                <table id="table2" class="table-hover text-nowrap">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama</th>
                            <th>Nomor Telepon</th>
                            <th>Tanggal Service</th>
                            <th>Waktu Service</th>
                            <th>Jenis</th>
                            <th>Merk</th>
                            <th>Nomor Polisi</th>
                            <th>Status</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            var no2 = 1;
                        }
                        @foreach (var obj in Model)
                        {
                            @if (obj.status == "Belum Diproses")
                            {
                                <tr>
                                    <td>@no</td>
                                    <td>@obj.Customer.nama_customer</td>
                                    <td>@obj.Customer.notelp_customer</td>
                                    <td>@obj.rencana_service_tanggal.ToString("D")</td>
                                    <td>@obj.rencana_service_waktu.ToString("T")</td>
                                    <td>@obj.jenis_kendaraan</td>
                                    <td>@obj.merk_kendaraan</td>
                                    <td>@obj.nomor_polisi</td>
                                    <td>@obj.status</td>
                                    <td style="color:#fff">
                                        <a class="btn btn-success btn-sm" data-toggle="modal">
                                            <i class="fa fa-check"></i>
                                        </a>
                                        <a class="btn btn-info btn-sm" data-toggle="modal" data-target="#modaledit">
                                            <i class="fa fa-edit"></i>
                                        </a>
                                        <a class="btn btn-danger btn-sm" data-toggle="modal" data-target="#modalhapus">
                                            <i class="fa fa-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                                no++;
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>*@
<script type="text/javascript">
    $(document).ready(function () {
        $('#table').DataTable();
    });

    //$(document).ready(function () {
    //    $('#table2').DataTable();
    //});
</script>
<script>
    if ("@TempData["IsDelete"]" != "") {
        const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
                confirmButton: 'btn btn-success mx-3 text-white',
                cancelButton: 'btn btn-danger mx-3 text-white'
            },
            buttonsStyling: false
        })

        swalWithBootstrapButtons.fire({
            title: 'Yakin Hapus Data?',
            text: "Booking yang dihapus tidak dapat dikembalikan",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Hapus!',
            cancelButtonText: 'Batal!',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                swalWithBootstrapButtons.fire(
                    'Berhasil!',
                    'Data berhasil dihapus',
                    'success'
                ).then((value) => {
                    window.location = "@Url.Action("DeleteConfirmed", "Booking", new { id = @TempData["ID"] })";
                });
            } else if (
                result.dismiss === Swal.DismissReason.cancel
            ) {

            }
        })
    }
</script>
<script>
    if ("@TempData["IsConfirm"]" != "") {
        const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
                confirmButton: 'btn btn-success mx-3 text-white',
                cancelButton: 'btn btn-danger mx-3 text-white'
            },
            buttonsStyling: false
        })

        swalWithBootstrapButtons.fire({
            title: 'Yakin Konfirmasi Data?',
            text: "Data yang dikonfirmasi akan dilanjutkan ke proses round checking!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Konfirmasi!',
            cancelButtonText: 'Batal!',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                swalWithBootstrapButtons.fire(
                    'Berhasil!',
                    'Data terkonfirmasi',
                    'success'
                ).then((value) => {
                    window.location = "@Url.Action("ConfirmBooking", "Booking", new { id = @TempData["ID"] })";
                });
            } else if (
                result.dismiss === Swal.DismissReason.cancel
            ) {

            }
        })
    }
</script>
<script>
    $(document).ready(function () {
        $('.btnUpdate').on('click', function () {
            // Call Modal Update
            $('#UpdateBooking').modal('show');
            // get data from button delete
            const id = $(this).data('id');
            const tanggal = $(this).data('tanggal');
            const waktu = $(this).data('waktu');
            const platno = $(this).data('platno');
            let tanggal2 = tanggal.split('/');
            var tanggalfinal = tanggal2[2] + '-' + tanggal2[1] + '-' + tanggal2[0];
            // Set data to Form Edit
            $('#id_booking').val(id);
            $('#tanggal').val(tanggalfinal);
            $('#waktu').val(waktu);
            $('#platno').text(platno);
        });
    });
</script>